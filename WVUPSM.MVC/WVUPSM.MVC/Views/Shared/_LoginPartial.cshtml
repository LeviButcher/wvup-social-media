@using Microsoft.AspNetCore.Identity
@using Microsoft.AspNetCore.Identity.EntityFrameworkCore;
@using WVUPSM.Models.Entities;

@inject SignInManager<User> SignInManager
@inject UserManager<User> UserManager

@if (SignInManager.IsSignedIn(User))
{
    <div class="dropdown">
        <button class="dropbtn" onclick="openMenu()">
            <span asp-route-userId="@UserManager.GetUserId(User)">@UserManager.GetUserName(User)</span>
            <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-content" id="dropdownNav">
            <a asp-controller="User" asp-action="Index" asp-route-userId="@UserManager.GetUserId(User)" class="header_link">Profile</a>
            @if (SignInManager.IsSignedIn(User) && User.IsInRole("Admin"))
             {
                <a class="header_link" asp-area="" asp-controller="Admin" asp-action="AdminMenu">Admin Menu</a>
             }
            <a class="header_link" asp-area="" asp-controller="Group" asp-action="MyGroups">Groups</a>
            <a class="header_link" asp-area="" asp-controller="RSS" asp-action="Index">Campus News</a>
            <a class="header_link" asp-area="" asp-controller="Home" asp-action="Settings">Settings</a>
            <form asp-area="" asp-controller="Home" asp-action="Logout" id="logoutForm" method="post">
                <a href="javascript:document.getElementById('logoutForm').submit()">Log out</a>
            </form>
        </div>
    </div>
    
    <script>
        function openMenu() {
            document.getElementById("dropdownNav").classList.toggle("show");
        }

        window.onclick = function (e) {
            if (!e.target.matches('.dropbtn')) {
                var myDropdown = document.getElementById("dropdownNav");
                if (myDropdown.classList.contains('show')) {
                    myDropdown.classList.remove('show');
                }
            }
        }
    </script>
}
